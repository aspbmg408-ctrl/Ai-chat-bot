<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChronoMind AI ‚Äî Tr·ª£ l√Ω th·ªùi gian th√¥ng minh</title>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #090e1a;
      --surface: #0f1628;
      --surface2: #162035;
      --border: #1e2d4a;
      --accent: #00d4ff;
      --accent2: #7b5ea7;
      --accent3: #00ffaa;
      --text: #e8f0ff;
      --text-dim: #7a8aaa;
      --user-bubble: #162545;
      --ai-bubble: #0f1e38;
      --glow: 0 0 30px rgba(0,212,255,0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Sora', sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100dvh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* Animated background */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 50% at 20% 10%, rgba(0,212,255,0.06) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 80%, rgba(123,94,167,0.08) 0%, transparent 60%),
        radial-gradient(ellipse 40% 30% at 60% 30%, rgba(0,255,170,0.04) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* Grid lines */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    /* HEADER */
    .header {
      position: relative;
      z-index: 10;
      padding: 14px 24px;
      background: rgba(9,14,26,0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-ring {
      width: 42px; height: 42px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      box-shadow: 0 0 20px rgba(0,212,255,0.3);
      flex-shrink: 0;
      animation: pulse-logo 3s ease-in-out infinite;
    }

    @keyframes pulse-logo {
      0%, 100% { box-shadow: 0 0 20px rgba(0,212,255,0.3); }
      50% { box-shadow: 0 0 35px rgba(0,212,255,0.55); }
    }

    .header-info { flex: 1; }
    .header-title {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.02em;
      background: linear-gradient(90deg, var(--accent), var(--accent3));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .header-sub {
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 1px;
      font-family: 'JetBrains Mono', monospace;
    }

    .status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--accent3);
      box-shadow: 0 0 8px var(--accent3);
      animation: blink 2s ease-in-out infinite;
      margin-right: 4px;
      display: inline-block;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* API KEY BAR */
    .api-bar {
      position: relative;
      z-index: 10;
      padding: 8px 16px;
      background: rgba(15,22,40,0.9);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .api-bar label {
      color: var(--text-dim);
      font-family: 'JetBrains Mono', monospace;
      white-space: nowrap;
      font-size: 11px;
    }

    .api-key-input {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 5px 10px;
      color: var(--text);
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      outline: none;
      transition: border-color 0.2s;
    }

    .api-key-input:focus { border-color: var(--accent); }
    .api-key-input::placeholder { color: var(--text-dim); }

    .demo-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 10px;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
      background: rgba(0,255,170,0.12);
      color: var(--accent3);
      border: 1px solid rgba(0,255,170,0.25);
      white-space: nowrap;
      cursor: default;
    }

    /* CHAT AREA */
    .chat-area {
      flex: 1;
      overflow-y: auto;
      padding: 20px 16px;
      position: relative;
      z-index: 5;
      scroll-behavior: smooth;
    }

    .chat-area::-webkit-scrollbar { width: 4px; }
    .chat-area::-webkit-scrollbar-track { background: transparent; }
    .chat-area::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

    .message {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      animation: msg-in 0.35s cubic-bezier(0.34,1.56,0.64,1) forwards;
      opacity: 0;
    }

    @keyframes msg-in {
      from { opacity: 0; transform: translateY(12px) scale(0.97); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .message.user { flex-direction: row-reverse; }

    .avatar {
      width: 32px; height: 32px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
      align-self: flex-end;
    }

    .avatar.ai {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 12px rgba(0,212,255,0.25);
    }

    .avatar.user {
      background: linear-gradient(135deg, #2a3a5c, #3a4d7a);
    }

    .bubble {
      max-width: min(75%, 560px);
      padding: 12px 16px;
      border-radius: 14px;
      font-size: 14px;
      line-height: 1.65;
      position: relative;
    }

    .bubble.ai {
      background: var(--ai-bubble);
      border: 1px solid var(--border);
      border-bottom-left-radius: 4px;
    }

    .bubble.user {
      background: var(--user-bubble);
      border: 1px solid rgba(0,212,255,0.15);
      border-bottom-right-radius: 4px;
      text-align: right;
    }

    .bubble strong { color: var(--accent); font-weight: 600; }
    .bubble em { color: var(--accent3); font-style: normal; font-weight: 500; }

    .bubble .schedule-block {
      margin-top: 10px;
      background: rgba(0,212,255,0.06);
      border: 1px solid rgba(0,212,255,0.2);
      border-radius: 10px;
      overflow: hidden;
    }

    .schedule-row {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid rgba(0,212,255,0.08);
      font-size: 13px;
      gap: 10px;
      transition: background 0.15s;
    }

    .schedule-row:last-child { border-bottom: none; }
    .schedule-row:hover { background: rgba(0,212,255,0.06); }

    .schedule-time {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent);
      font-size: 12px;
      min-width: 52px;
      font-weight: 600;
    }

    .schedule-task { flex: 1; color: var(--text); }
    .schedule-icon { font-size: 16px; }

    /* Quick suggestions */
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .suggestion-btn {
      padding: 7px 14px;
      background: rgba(0,212,255,0.08);
      border: 1px solid rgba(0,212,255,0.2);
      border-radius: 20px;
      color: var(--accent);
      font-size: 12px;
      font-family: 'Sora', sans-serif;
      cursor: pointer;
      transition: all 0.2s;
    }

    .suggestion-btn:hover {
      background: rgba(0,212,255,0.18);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    /* Typing indicator */
    .typing-indicator {
      display: flex;
      gap: 4px;
      align-items: center;
      padding: 14px 16px;
    }

    .typing-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--accent);
      animation: typing 1.2s ease-in-out infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-6px); opacity: 1; }
    }

    /* INPUT AREA */
    .input-area {
      position: relative;
      z-index: 10;
      padding: 12px 16px 16px;
      background: rgba(9,14,26,0.9);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
    }

    .input-row {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px 14px;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .input-row:focus-within {
      border-color: rgba(0,212,255,0.4);
      box-shadow: 0 0 20px rgba(0,212,255,0.08);
    }

    #user-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      font-family: 'Sora', sans-serif;
      font-size: 14px;
      resize: none;
      max-height: 120px;
      line-height: 1.5;
    }

    #user-input::placeholder { color: var(--text-dim); }

    .send-btn {
      width: 36px; height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      transition: all 0.2s;
      flex-shrink: 0;
      box-shadow: 0 0 15px rgba(0,212,255,0.25);
    }

    .send-btn:hover {
      transform: scale(1.08);
      box-shadow: 0 0 25px rgba(0,212,255,0.45);
    }

    .send-btn:active { transform: scale(0.95); }
    .send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    .input-hint {
      font-size: 10px;
      color: var(--text-dim);
      text-align: center;
      margin-top: 8px;
      font-family: 'JetBrains Mono', monospace;
    }

    /* Welcome screen */
    .welcome {
      text-align: center;
      padding: 40px 20px;
      animation: msg-in 0.5s ease forwards;
    }

    .welcome-icon {
      font-size: 52px;
      display: block;
      margin-bottom: 16px;
      filter: drop-shadow(0 0 20px rgba(0,212,255,0.5));
    }

    .welcome h2 {
      font-size: 22px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent), var(--accent3));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 8px;
    }

    .welcome p {
      color: var(--text-dim);
      font-size: 14px;
      line-height: 1.6;
      max-width: 380px;
      margin: 0 auto 24px;
    }

    .quick-starts {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-width: 420px;
      margin: 0 auto;
    }

    .qs-btn {
      padding: 12px 16px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      color: var(--text);
      font-size: 13px;
      font-family: 'Sora', sans-serif;
      cursor: pointer;
      text-align: left;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .qs-btn:hover {
      border-color: rgba(0,212,255,0.35);
      background: rgba(0,212,255,0.06);
      transform: translateX(4px);
    }

    .qs-icon { font-size: 18px; }

    /* Responsive */
    @media (max-width: 480px) {
      .header { padding: 12px 14px; }
      .bubble { max-width: 88%; font-size: 13px; }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="logo-ring">‚è±Ô∏è</div>
  <div class="header-info">
    <div class="header-title">ChronoMind AI</div>
    <div class="header-sub"><span class="status-dot"></span>Tr·ª£ l√Ω th·ªùi gian c√° nh√¢n h√≥a ¬∑ AI 9.0</div>
  </div>
  <div class="demo-badge">‚ú¶ DEMO</div>
</div>

<!-- API KEY BAR -->
<div class="api-bar">
  <label>üîë OpenAI API Key:</label>
  <input class="api-key-input" type="password" id="api-key" placeholder="sk-... (ƒë·ªÉ tr·ªëng d√πng ch·∫ø ƒë·ªô Demo th√¥ng minh)" />
</div>

<!-- CHAT AREA -->
<div class="chat-area" id="chat-area">
  <!-- Welcome screen -->
  <div class="welcome" id="welcome-screen">
    <span class="welcome-icon">üß†</span>
    <h2>Ch√†o m·ª´ng ƒë·∫øn v·ªõi ChronoMind AI</h2>
    <p>T√¥i s·∫Ω gi√∫p b·∫°n x√¢y d·ª±ng th·ªùi gian bi·ªÉu c√° nh√¢n h√≥a, th√¥ng minh ‚Äî ƒë·ªÉ b·∫°n kh√¥ng bao gi·ªù ƒëi tr·ªÖ n·ªØa.</p>
    <div class="quick-starts">
      <button class="qs-btn" onclick="quickStart(this)">
        <span class="qs-icon">üìÖ</span>
        T√¥i mu·ªën t·∫°o th·ªùi gian bi·ªÉu cho ng√†y mai
      </button>
      <button class="qs-btn" onclick="quickStart(this)">
        <span class="qs-icon">‚è∞</span>
        H√¥m nay t√¥i hay ƒëi tr·ªÖ, gi√∫p t√¥i c·∫£i thi·ªán
      </button>
      <button class="qs-btn" onclick="quickStart(this)">
        <span class="qs-icon">üéì</span>
        S·∫Øp x·∫øp l·ªãch h·ªçc v√† ngh·ªâ ng∆°i h·ª£p l√Ω
      </button>
      <button class="qs-btn" onclick="quickStart(this)">
        <span class="qs-icon">üíº</span>
        C√¢n b·∫±ng l·ªãch l√†m vi·ªác v√† cu·ªôc s·ªëng
      </button>
    </div>
  </div>
</div>

<!-- INPUT AREA -->
<div class="input-area">
  <div class="input-row">
    <textarea id="user-input" rows="1" placeholder="Nh·∫≠p ho·∫°t ƒë·ªông c·ªßa b·∫°n... (VD: H·ªçc l√∫c 7h, h·ªçc th√™m 3h chi·ªÅu, √¥n thi t·ªëi 2 ti·∫øng)" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
    <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
  </div>
  <div class="input-hint">Enter ƒë·ªÉ g·ª≠i ¬∑ Shift+Enter xu·ªëng d√≤ng ¬∑ Nh·∫≠p API key ƒë·ªÉ d√πng AI th·∫≠t</div>
</div>

<script>
  const chatArea = document.getElementById('chat-area');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const welcomeScreen = document.getElementById('welcome-screen');

  let conversationHistory = [];
  let isProcessing = false;

  const SYSTEM_PROMPT = `B·∫°n l√† ChronoMind AI ‚Äî m·ªôt tr·ª£ l√Ω th√¥ng minh chuy√™n t·∫°o th·ªùi gian bi·ªÉu c√° nh√¢n h√≥a gi√∫p ng∆∞·ªùi d√πng qu·∫£n l√Ω th·ªùi gian hi·ªáu qu·∫£ v√† kh√¥ng ƒëi tr·ªÖ.

Nhi·ªám v·ª• c·ªßa b·∫°n:
1. Thu th·∫≠p th√¥ng tin v·ªÅ c√°c ho·∫°t ƒë·ªông trong ng√†y c·ªßa ng∆∞·ªùi d√πng (gi·ªù h·ªçc, gi·ªù l√†m, di chuy·ªÉn, ƒÉn u·ªëng, ngh·ªâ ng∆°i...)
2. Ph√¢n t√≠ch v√† t·∫°o ra th·ªùi gian bi·ªÉu h·ª£p l√Ω, c√≥ t√≠nh ƒë·∫øn th·ªùi gian ƒë·ªám, di chuy·ªÉn, v√† nh·ªãp sinh h·ªçc
3. ƒê∆∞a ra g·ª£i √Ω c·∫£i thi·ªán th√≥i quen c·ª• th·ªÉ
4. Tr·∫£ l·ªùi b·∫±ng ti·∫øng Vi·ªát, th√¢n thi·ªán, ng·∫Øn g·ªçn nh∆∞ng c√≥ chi·ªÅu s√¢u

Khi t·∫°o th·ªùi gian bi·ªÉu, h√£y format nh∆∞ sau (b·∫Øt bu·ªôc):
[SCHEDULE]
HH:MM | icon | T√™n ho·∫°t ƒë·ªông
HH:MM | icon | T√™n ho·∫°t ƒë·ªông
[/SCHEDULE]

C√°c icon g·ª£i √Ω: üåÖ th·ª©c d·∫≠y, üç≥ ƒÉn s√°ng, üöå di chuy·ªÉn, üìö h·ªçc, ‚òï ngh·ªâ gi·∫£i lao, üç± ƒÉn tr∆∞a, üí™ th·ªÉ d·ª•c, üìñ t·ª± h·ªçc, üåô ng·ªß, üíº l√†m vi·ªác

Lu√¥n h·ªèi th√™m th√¥ng tin n·∫øu c·∫ßn ƒë·ªÉ t·∫°o l·ªãch c√° nh√¢n h√≥a h∆°n. Sau l·ªãch tr√¨nh, ƒë∆∞a ra 2-3 l·ªùi khuy√™n ng·∫Øn g·ªçn.`;

  // DEMO responses khi kh√¥ng c√≥ API key
  const demoResponses = {
    keywords: {
      'ƒëi tr·ªÖ|mu·ªôn|tr·ªÖ': demoLate,
      'ng√†y mai|h√¥m nay|l·ªãch': demoSchedule,
      'h·ªçc|sinh vi√™n|b√†i t·∫≠p': demoStudy,
      'l√†m|c√¥ng vi·ªác|vƒÉn ph√≤ng': demoWork,
      'ng·ªß|ngh·ªâ|m·ªát': demoRest,
      'default': demoDefault
    }
  };

  function demoLate() {
    return `T√¥i hi·ªÉu r·ªìi! ƒêi tr·ªÖ th∆∞·ªùng do **thi·∫øu th·ªùi gian ƒë·ªám** v√† **kh√¥ng c√≥ k·∫ø ho·∫°ch c·ª• th·ªÉ**. üéØ

H√£y cho t√¥i bi·∫øt:
- B·∫°n c·∫ßn c√≥ m·∫∑t ·ªü ƒë√¢u v√† l√∫c m·∫•y gi·ªù?
- Nh√† b·∫°n c√°ch ƒë√≥ bao l√¢u (xe m√°y/xe bu√Ωt)?
- Bu·ªïi s√°ng b·∫°n th∆∞·ªùng l√†m g√¨ tr∆∞·ªõc khi ƒëi?

T√¥i s·∫Ω t·∫°o l·ªãch s√°ng **ch·ªëng-ƒëi-tr·ªÖ** cho b·∫°n ngay! ‚è∞`;
  }

  function demoSchedule() {
    return `Tuy·ªát! H√£y ƒë·ªÉ t√¥i gi√∫p b·∫°n x√¢y d·ª±ng th·ªùi gian bi·ªÉu. ƒê·ªÉ c√° nh√¢n h√≥a t·ªët nh·∫•t, b·∫°n cho t√¥i bi·∫øt:

**1.** B·∫°n c·∫ßn ƒë·∫øn tr∆∞·ªùng/c∆° quan l√∫c m·∫•y gi·ªù?
**2.** Th·ªùi gian di chuy·ªÉn bao l√¢u?
**3.** Bu·ªïi t·ªëi b·∫°n c√≥ ho·∫°t ƒë·ªông g√¨ kh√¥ng (h·ªçc th√™m, th·ªÉ d·ª•c, v.v.)?

Ho·∫∑c n·∫øu mu·ªën th·ª≠ ngay, h√£y nh·∫•n **"T√¥i h·ªçc l√∫c 7h, h·ªçc th√™m 3h chi·ªÅu"** ƒë·ªÉ xem m·∫´u l·ªãch! üìã`;
  }

  function demoStudy() {
    const msg = userInput._lastValue || '';
    return `T√¥i s·∫Ω t·∫°o th·ªùi gian bi·ªÉu h·ªçc t·∫≠p ph√π h·ª£p cho b·∫°n! üìö

[SCHEDULE]
06:00 | üåÖ | Th·ª©c d·∫≠y ‚Äî u·ªëng n∆∞·ªõc, v∆∞∆°n vai
06:15 | üç≥ | ƒÇn s√°ng nh·∫π (ƒë·ª´ng b·ªè b·ªØa!)
06:40 | üöå | Chu·∫©n b·ªã & kh·ªüi h√†nh
07:00 | üìö | H·ªçc ch√≠nh kh√≥a
11:30 | üç± | ƒÇn tr∆∞a + ngh·ªâ ng∆°i 20 ph√∫t
13:00 | ‚òï | √în b√†i nh·∫π / ƒë·ªçc s√°ch
15:00 | üìñ | H·ªçc th√™m / ngo·∫°i kh√≥a
17:30 | üí™ | Th·ªÉ d·ª•c 30 ph√∫t (tƒÉng t·∫≠p trung!)
19:00 | üçΩÔ∏è | ƒÇn t·ªëi c√πng gia ƒë√¨nh
19:45 | üìö | √în thi / l√†m b√†i t·∫≠p
21:30 | ‚òï | Ngh·ªâ gi·∫£i lao 15 ph√∫t
21:45 | üìñ | ƒê·ªçc s√°ch / chu·∫©n b·ªã cho ng√†y mai
22:30 | üåô | ƒêi ng·ªß ƒë√∫ng gi·ªù
[/SCHEDULE]

üí° **L·ªùi khuy√™n:**
- Ng·ªß ƒë·ªß **7-8 ti·∫øng** gi√∫p ghi nh·ªõ t·ªët h∆°n 40%
- ƒê·∫∑t b√°o th·ª©c s·ªõm h∆°n **30 ph√∫t** so v·ªõi gi·ªù th·∫≠t
- Chu·∫©n b·ªã ƒë·ªì d√πng t·ª´ t·ªëi h√¥m tr∆∞·ªõc`;
  }

  function demoWork() {
    return `ƒê√¢y l√† th·ªùi gian bi·ªÉu t·ªëi ∆∞u cho ng∆∞·ªùi ƒëi l√†m! üíº

[SCHEDULE]
06:00 | üåÖ | Th·ª©c d·∫≠y ‚Äî kh√¥ng snooze!
06:20 | üç≥ | ƒÇn s√°ng (quan tr·ªçng cho n√£o b·ªô)
06:50 | üöå | Di chuy·ªÉn ƒë·∫øn c∆° quan
08:00 | üíº | B·∫Øt ƒë·∫ßu l√†m vi·ªác ‚Äî deep work
10:00 | ‚òï | Ngh·ªâ gi·∫£i lao 10 ph√∫t
10:10 | üíº | Ti·∫øp t·ª•c c√¥ng vi·ªác
12:00 | üç± | ƒÇn tr∆∞a + ƒëi b·ªô nh·∫π
13:30 | üíº | L√†m vi·ªác bu·ªïi chi·ªÅu
15:30 | ‚òï | Break ng·∫Øn, review to-do list
17:30 | üè† | K·∫øt th√∫c & v·ªÅ nh√†
18:30 | üí™ | Th·ªÉ d·ª•c / th∆∞ gi√£n
20:00 | üçΩÔ∏è | ƒÇn t·ªëi
21:00 | üì± | Th·ªùi gian c√° nh√¢n
22:30 | üåô | Chu·∫©n b·ªã ng·ªß
23:00 | üò¥ | Ng·ªß
[/SCHEDULE]

üí° **Tips nƒÉng su·∫•t:**
- **"Eat the frog"**: l√†m vi·ªác kh√≥ nh·∫•t v√†o ƒë·∫ßu bu·ªïi s√°ng
- T·∫Øt th√¥ng b√°o ƒëi·ªán tho·∫°i trong deep work
- Review ng√†y h√¥m sau **tr∆∞·ªõc khi ng·ªß**`;
  }

  function demoRest() {
    return `Ngh·ªâ ng∆°i ƒë√∫ng c√°ch c≈©ng l√† m·ªôt k·ªπ nƒÉng quan tr·ªçng! üò¥

M·ªôt s·ªë g·ª£i √Ω t·ª´ ChronoMind AI:

**üß† Quy t·∫Øc 90 ph√∫t:** L√†m vi·ªác t·∫≠p trung 90 ph√∫t, ngh·ªâ 15-20 ph√∫t. N√£o b·ªô ho·∫°t ƒë·ªông theo chu k·ª≥ n√†y.

**üì± Digital detox:** T·∫Øt m√†n h√¨nh √≠t nh·∫•t **1 ti·∫øng tr∆∞·ªõc khi ng·ªß** ‚Äî √°nh s√°ng xanh l√†m kh√≥ ng·ªß.

**‚è∞ Ng·ªß ƒë√∫ng gi·ªù:** C·ªë g·∫Øng ng·ªß v√† th·ª©c d·∫≠y c√πng m·ªôt gi·ªù m·ªói ng√†y, k·ªÉ c·∫£ cu·ªëi tu·∫ßn.

B·∫°n c√≥ mu·ªën t√¥i t·∫°o m·ªôt l·ªãch ngh·ªâ ng∆°i c√¢n b·∫±ng v·ªõi c√¥ng vi·ªác/h·ªçc t·∫≠p kh√¥ng? üåô`;
  }

  function demoDefault() {
    return `Xin ch√†o! T√¥i l√† **ChronoMind AI** ‚Äî tr·ª£ l√Ω th·ªùi gian th√¥ng minh c·ªßa b·∫°n. ‚è±Ô∏è

T√¥i c√≥ th·ªÉ gi√∫p b·∫°n:
- ‚úÖ T·∫°o th·ªùi gian bi·ªÉu c√° nh√¢n h√≥a
- ‚úÖ Ph√¢n t√≠ch th√≥i quen v√† ƒë·ªÅ xu·∫•t c·∫£i thi·ªán
- ‚úÖ T√≠nh to√°n th·ªùi gian ƒë·ªám ƒë·ªÉ kh√¥ng ƒëi tr·ªÖ
- ‚úÖ C√¢n b·∫±ng h·ªçc t·∫≠p, l√†m vi·ªác v√† ngh·ªâ ng∆°i

H√£y cho t√¥i bi·∫øt l·ªãch tr√¨nh c·ªßa b·∫°n ng√†y h√¥m nay/ng√†y mai ƒë·ªÉ b·∫Øt ƒë·∫ßu nh√©! üìÖ`;
  }

  function getDemoResponse(text) {
    const lower = text.toLowerCase();
    for (const [pattern, fn] of Object.entries(demoResponses.keywords)) {
      if (pattern === 'default') continue;
      if (new RegExp(pattern).test(lower)) return fn();
    }
    // Check for schedule data
    if (/\d+h|\d+:\d+|gi·ªù|s√°ng|chi·ªÅu|t·ªëi/.test(lower)) return demoStudy();
    return demoDefault();
  }

  function parseSchedule(text) {
    const match = text.match(/\[SCHEDULE\]([\s\S]*?)\[\/SCHEDULE\]/);
    if (!match) return null;
    const lines = match[1].trim().split('\n').filter(l => l.trim());
    return lines.map(line => {
      const parts = line.split('|').map(p => p.trim());
      return { time: parts[0], icon: parts[1], task: parts[2] };
    });
  }

  function renderMessage(content, role) {
    const schedule = parseSchedule(content);
    let cleanContent = content.replace(/\[SCHEDULE\][\s\S]*?\[\/SCHEDULE\]/g, '');

    // Format markdown-like
    cleanContent = cleanContent
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      .replace(/\n/g, '<br>');

    const div = document.createElement('div');
    div.className = `message ${role}`;

    const avatar = document.createElement('div');
    avatar.className = `avatar ${role}`;
    avatar.textContent = role === 'ai' ? 'üß†' : 'üë§';

    const bubble = document.createElement('div');
    bubble.className = `bubble ${role}`;
    bubble.innerHTML = cleanContent;

    if (schedule && schedule.length > 0) {
      const block = document.createElement('div');
      block.className = 'schedule-block';
      schedule.forEach(row => {
        const r = document.createElement('div');
        r.className = 'schedule-row';
        r.innerHTML = `
          <span class="schedule-time">${row.time}</span>
          <span class="schedule-icon">${row.icon}</span>
          <span class="schedule-task">${row.task}</span>
        `;
        block.appendChild(r);
      });
      bubble.appendChild(block);
    }

    div.appendChild(avatar);
    div.appendChild(bubble);
    return div;
  }

  function addMessage(content, role) {
    if (welcomeScreen && welcomeScreen.parentNode) {
      welcomeScreen.remove();
    }
    const el = renderMessage(content, role);
    chatArea.appendChild(el);
    setTimeout(() => chatArea.scrollTop = chatArea.scrollHeight, 50);
  }

  function showTyping() {
    const div = document.createElement('div');
    div.className = 'message ai';
    div.id = 'typing-msg';
    div.innerHTML = `
      <div class="avatar ai">üß†</div>
      <div class="bubble ai">
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>`;
    if (welcomeScreen && welcomeScreen.parentNode) welcomeScreen.remove();
    chatArea.appendChild(div);
    chatArea.scrollTop = chatArea.scrollHeight;
  }

  function removeTyping() {
    const t = document.getElementById('typing-msg');
    if (t) t.remove();
  }

  async function callOpenAI(apiKey, messages) {
    const res = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
      },
      body: JSON.stringify({
        model: 'gpt-3.5-turbo',
        messages: [{ role: 'system', content: SYSTEM_PROMPT }, ...messages],
        max_tokens: 800,
        temperature: 0.7
      })
    });
    if (!res.ok) throw new Error(`API Error: ${res.status}`);
    const data = await res.json();
    return data.choices[0].message.content;
  }

  async function sendMessage() {
    const text = userInput.value.trim();
    if (!text || isProcessing) return;

    isProcessing = true;
    sendBtn.disabled = true;
    userInput.value = '';
    userInput.style.height = 'auto';

    addMessage(text, 'user');
    conversationHistory.push({ role: 'user', content: text });

    showTyping();

    const apiKey = document.getElementById('api-key').value.trim();

    try {
      let response;
      if (apiKey && apiKey.startsWith('sk-')) {
        // D√πng OpenAI th·∫≠t
        response = await callOpenAI(apiKey, conversationHistory);
      } else {
        // Demo mode v·ªõi delay gi·∫£ l·∫≠p
        await new Promise(r => setTimeout(r, 1200 + Math.random() * 800));
        response = getDemoResponse(text);
      }
      removeTyping();
      conversationHistory.push({ role: 'assistant', content: response });
      addMessage(response, 'ai');
    } catch (err) {
      removeTyping();
      addMessage(`‚ö†Ô∏è **L·ªói k·∫øt n·ªëi:** ${err.message}\n\nVui l√≤ng ki·ªÉm tra API key ho·∫∑c k·∫øt n·ªëi m·∫°ng. B·∫°n c√≥ th·ªÉ d√πng **ch·∫ø ƒë·ªô Demo** b·∫±ng c√°ch x√≥a API key.`, 'ai');
    }

    isProcessing = false;
    sendBtn.disabled = false;
    userInput.focus();
  }

  function quickStart(btn) {
    userInput.value = btn.querySelector('.qs-btn') ? '' : btn.textContent.trim().replace(/^[\p{Emoji}\s]+/u, '').trim();
    userInput.value = btn.textContent.trim().replace(/^\S+\s/, '').trim();
    sendMessage();
  }

  function handleKey(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  }

  function autoResize(el) {
    el.style.height = 'auto';
    el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  }
</script>
</body>
</html>
